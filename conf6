ğŸ§­ 1. Overview

Objective

This document outlines an AI-assisted API Automation Framework built using Playwright and Cucumber.js, which automates API endpoint validation directly from Swagger definitions.

Purpose

To create a configuration-driven, schema-validated, and visually reportable API automation suite that:

Runs against Swagger/OpenAPI-defined endpoints

Validates API contract compliance (schema validation)

Categorizes failures (Critical, Validation Gaps, Schema Violations)

Generates multiple report formats (Cucumber HTML/JSON, Allure dashboard, TEST_SUMMARY.md)

Requires zero manual intervention after initial .env configuration

Key Highlights

â— Config-driven approach: Read API specification and authentication from .env file. 

â— Auto-generates Playwright + Cucumber test suites from Swagger/OpenAPI (JSON or URL). 

â— Schema validation: Validates response structure using Ajv (required fields + data types). 

â— Allure reporting: Interactive HTML dashboards with test statistics and trends. 

â— Automatic retry logic: 3 attempts per scenario for transient failures. 

â— Flexible authentication: Supports Basic Auth, Bearer Token, or none. 

â— Seamlessly integrates with GitHub Copilot.

Technical Stack

ğŸ§© Playwright â€“ APIRequestContext for HTTP calls and response handling

ğŸ§  Cucumber.js v10+ â€“ BDD test framework with retry configuration

âœ… Chai v5+ â€“ Assertion library for response validation

ğŸ”’ Ajv v8+ â€“ JSON Schema validation for API contract compliance

ğŸ“Š Allure â€“ Primary reporting tool with interactive dashboards

ğŸ¤– GitHub Copilot â€“ AI-powered test generation from .copilot-instructions

ğŸ” dotenv â€“ Environment variable management

âš™ï¸ 2. Prerequisites

â— Active GitHub Copilot Business License 

â— Node.js v18+ and npm 

â— Playwright v1.45+ (APIRequestContext support) 

â— Swagger/OpenAPI specification (JSON file or URL)

â— .env file - Environment variables used during test execution

ğŸ’» Supported IDEs

The framework is compatible with both:

IDE

Status

Notes

VS Code       

âœ… Recommended 

Seamless Copilot & GHCP integration        

ğŸ§© 3. Architecture Diagram

Key Features

Configuration-Driven: All settings in .env (no hardcoded values)

Schema Validation: Validates response structure against API specification

Automatic Retry: Cucumber retries failed scenarios 3 times

Failure Categorization: Critical, Validation Gaps, Schema Violations, Not Applicable

Multiple Reports: Cucumber, Allure, and markdown summaries

ğŸš€ 4. Setup & Configuration

Step 1: Configure .env File 

Create a .env file at the project root and add the required environment variables (INPUT_TYPE, INPUT_PATH, AUTH_TYPE)

Step 2: Create .copilot-instructions file

Create a .copilot-instructions file in the project root and add the prompts that instruct GitHub copilot to generate API tests.

Step 3: Provide the â€˜User Promptâ€™ to GitHub Copilot in the GHCP Chat. 

ğŸ§ª 5. Test Coverage

For Each Endpoint Operation:

1. Positive Scenarios (200/201/204)

Validates successful operations per Swagger definitions

Schema validation performed on responses:

GET (200): ALWAYS validate response schema

POST/PUT (200/201): Validate IF response returns an object

If test fails â†’ indicates API bug (not test bug)

2. Negative Scenarios

HTTP Method

Tested Negative Codes

GET

401, 404, 500

POST

400, 401, 404, 500

PUT

400, 404, 500

DELETE

400, 404, 500

Note: Negative tests may fail if:

API lacks input validation (returns 200 instead of 400) â†’ Validation Gap

API returns wrong error code (returns 500 instead of 400) â†’ Wrong Error Code

These are documented in TEST_SUMMARY.md as expected failures.

ğŸ”„ 6. Retry & Failure Handling

Automatic Retry Logic

Cucumber configuration: retry: 3 (3 attempts per scenario)

Purpose: Handle transient environment issues (network glitches, temporary service issues)

Behavior:

Test fails â†’ automatically retries up to 3 times

Passes on retry â†’ transient issue (test passes)

Fails all 3 retries â†’ genuine API issue (marked as FAILED)

Failure Categorization

All failures are documented in TEST_SUMMARY.md:

1. Positive Scenario Failures (CRITICAL)

Swagger-defined success responses that fail

Example: POST expects 200 but returns 500

Action: These indicate API bugs

2. Negative Scenario Failures - Validation Gaps

API returns 200 instead of 400 (missing input validation)

Documented in "Not Applicable Test Cases"

Reason: API lacks input validation

3. Negative Scenario Failures - Wrong Error Code

API returns 500 instead of 400/404

Documented in "Failed Test Cases â†’ Negative Scenarios"

Reason: API has poor error handling

4. Schema Validation Failures (CRITICAL)

Response structure doesn't match API specification

Examples: Missing required fields, wrong data types, unexpected fields

Action: API contract violation - requires immediate attention

ğŸ“Š 7. Reporting

Three Report Types Generated:

1. Cucumber HTML/JSON Reports

Location: cucumber-report.html, cucumber-report.json

Basic test execution summary with step-level details

2. Allure Report (Primary)

Generate the report using the test run (Allure results get stored in allure-results/folder).     

To open the Allure dashboard, run â€˜npm run allure:openâ€™.

Interactive dashboard with:

Test statistics and trends

Categorized failures

Step-level logs and stack traces

Drill-down capabilities

Open with: npm run allure:open

3. TEST_SUMMARY.md

Comprehensive markdown summary with:

Test Results (Total, Passed, Failed, Success Rate)

Test Coverage by Endpoint (âœ…/âŒ/âš ï¸)

Failed Test Cases (categorized by type)

Not Applicable Test Cases (validation gaps)

API Issues Requiring Attention (Critical vs Behavior Issues)

Next Steps (prioritized action items)

ğŸ§ª 8. Sample Test Case

Feature: Order Management API

  @order @positive
  Scenario: Successfully place a new order
    Given I have a valid order payload
    When I send a POST request to "/store/order"
    Then the response status code should be 200
    And the response should match the order schema
    And the response should contain field "id"

  @order @negative
  Scenario: Place order with missing required fields
    Given I have an order payload with missing required field "productId"
    When I send a POST request to "/store/order"
    Then the response status code should be 400

Note:

Each test is self-contained with automatic retry (3 attempts)

Schema validation is performed on successful responses

Failures are categorized and documented in TEST_SUMMARY.md

ğŸ” 9. Key Observations

Configuration-Driven Approach

All configuration centralized in .env file

No hardcoded values in test code

Easy to switch between environments or API specifications

Parallel Execution Support

The framework supports full parallel execution using cucumber.js (--parallel), with each scenario running in its own isolated manner.

Ensures thread-safe execution by creating a separate playwright context per worker, enabling high-scale API test runs.

Schema Validation

Validates API contract compliance using Ajv

Catches response structure issues early

Documented as CRITICAL failures (API contract violations)

Authentication Flexibility

Supports multiple auth types: basic, bearer, none

Configured via AUTH_TYPE in .env

No code changes needed to switch auth methods

Test Philosophy

Tests NEVER modified to match API behavior

Tests reflect expected behavior per specification

Failures indicate API issues, not test issues

Pass rate may be < 100% due to API bugs (this is expected)

ğŸ 10. Conclusion

This framework demonstrates how Playwright + Cucumber + Ajv + Allure + GitHub Copilot can automate comprehensive API testing using Swagger/OpenAPI specifications with:

âœ… Zero manual intervention after .env configuration
âœ… Schema validation for API contract compliance
âœ… Flexible authentication (basic/bearer/none)
âœ… Automatic retry logic (3 attempts per scenario)
âœ… Visual reporting with Allure dashboards
âœ… Failure categorization (Critical, Validation Gaps, Schema Violations)
âœ… AI-assisted test generation via GitHub Copilot

The framework ensures reliable, repeatable regression testing that adapts dynamically to API changes while maintaining strict validation of API contracts and behavior.

Sample Executions

Product Team

Prompt Used

Input URL (Swagger/json)

Output (Regression Test Files)

Final Execution Report

O9



https://pigw-mpcon-ca.marksandspencer.app/swagger-ui.html

4. README.md (Auto-Generated Documentation)
A high-level project documentation file summarizing:
- Execution commands
- How to generate and open Allure reports
- Folder structure
- Test coverage and explanation of auto-generated files

Generated at project root for easy onboarding.

# ğŸš€ MPSaleOrders API Test Suite

Complete Playwright + Cucumber API test automation suite for MPSaleOrders API with schema validation, authentication, and comprehensive reporting.

## ğŸ“‹ Project Overview

This test suite provides automated API testing for all 8 endpoints in the MPSaleOrders API specification, including:
- âœ… Positive scenario testing (200/201 responses)
- âŒ Negative scenario testing (400/401/404/500 responses)
- ğŸ”’ Authentication testing (Basic Auth)
- ğŸ“Š Schema validation using Ajv
- ğŸ”„ Automatic retry logic (3 attempts)
- ğŸ“ˆ Multiple report formats (Cucumber HTML, Allure Dashboard, TEST_SUMMARY.md)

## ğŸ¯ Test Results Summary

**Latest Execution**:
- **Total Scenarios**: 37 (19 passed, 18 failed)
- **Success Rate**: 51.35%
- **Execution Time**: ~16 seconds
- **Critical Issues Found**: 2 (Order Webhook 500 error, CA Stub schema mismatch)
- **Security Issues Found**: 6 endpoints missing authentication enforcement

ğŸ“– **See [TEST_SUMMARY.md](./TEST_SUMMARY.md) for detailed results**

## ğŸ“ Project Structure

```
PlaywrightAPIFinal09Demo/
â”œâ”€â”€ features/                                   # Cucumber feature files (Gherkin)
â”‚   â”œâ”€â”€ updateDownstreamProcessStatus.feature
â”‚   â”œâ”€â”€ testException.feature
â”‚   â”œâ”€â”€ orderWebhook.feature
â”‚   â”œâ”€â”€ getCaStubApi.feature
â”‚   â”œâ”€â”€ caReprocessOrders.feature
â”‚   â”œâ”€â”€ bulkOrderProcess.feature
â”‚   â”œâ”€â”€ bulkOrderProcessWithDateRange.feature
â”‚   â”œâ”€â”€ processPaymentClearedOrders.feature
â”‚   â”œâ”€â”€ step_definitions/                      # Step implementations
â”‚   â”‚   â”œâ”€â”€ updateDownstreamProcessStatus_steps.js
â”‚   â”‚   â”œâ”€â”€ testException_steps.js
â”‚   â”‚   â”œâ”€â”€ orderWebhook_steps.js
â”‚   â”‚   â”œâ”€â”€ getCaStubApi_steps.js
â”‚   â”‚   â”œâ”€â”€ caReprocessOrders_steps.js
â”‚   â”‚   â”œâ”€â”€ bulkOrderProcess_steps.js
â”‚   â”‚   â”œâ”€â”€ bulkOrderProcessWithDateRange_steps.js
â”‚   â”‚   â””â”€â”€ processPaymentClearedOrders_steps.js
â”‚   â””â”€â”€ support/                               # Cucumber support files
â”‚       â”œâ”€â”€ world.js                           # Playwright context setup
â”‚       â””â”€â”€ hooks.js                           # Before/After hooks
â”œâ”€â”€ helpers/                                    # Utility classes
â”‚   â”œâ”€â”€ orderApiHelper.js                      # API methods with retry
â”‚   â”œâ”€â”€ schemaValidator.js                     # Ajv schema validation
â”‚   â””â”€â”€ retryHelper.js                         # Retry logic utility
â”œâ”€â”€ models/                                     # Data models
â”‚   â””â”€â”€ orderModels.js                         # Request/response models
â”œâ”€â”€ reports/                                    # Test reports
â”‚   â”œâ”€â”€ cucumber-report.html                   # Cucumber HTML report
â”‚   â””â”€â”€ cucumber-report.json                   # Cucumber JSON report
â”œâ”€â”€ allure-results/                            # Allure raw results
â”œâ”€â”€ allure-report/                             # Allure HTML dashboard
â”œâ”€â”€ api/
â”‚   â””â”€â”€ salesOrderApiDev.json                  # OpenAPI specification
â”œâ”€â”€ .env                                        # Environment configuration
â”œâ”€â”€ .env.example                               # Environment template
â”œâ”€â”€ cucumber.js                                # Cucumber configuration
â”œâ”€â”€ playwright.config.js                       # Playwright configuration
â”œâ”€â”€ generate-allure.js                         # Allure report generator
â”œâ”€â”€ package.json                               # Dependencies & scripts
â”œâ”€â”€ TEST_SUMMARY.md                            # Comprehensive test summary
â””â”€â”€ README.md                                  # This file
```

## ğŸ› ï¸ Prerequisites

- **Node.js**: v18 or higher
- **npm**: v8 or higher
- **Java**: Required for Allure report generation

## ğŸ“¦ Installation

```bash
# Clone the repository or navigate to project directory
cd PlaywrightAPIFinal09Demo

# Install dependencies
npm install
```

## âš™ï¸ Configuration

Update `.env` file with your API credentials:

```bash
# API Configuration
BASE_URL=https://pigw-mpcon-ca.dev.marksandspencer.app

# Authentication Configuration
AUTH_TYPE=basic                    # Options: basic, bearer, none
AUTH_USERNAME=your_username
AUTH_PASSWORD=your_password

# API Specification
INPUT_TYPE=swagger_json
INPUT_PATH=./api/salesOrderApiDev.json
```

## ğŸš€ Running Tests

### Execute Full Test Suite
```bash
npm test
```

### Run Specific Feature
```bash
npx cucumber-js features/orderWebhook.feature
```

### Watch Mode (Re-run on file changes)
```bash
npm run test:watch
```

## ğŸ“Š Generating Reports

### Cucumber HTML Report
Automatically generated after test execution:
```bash
# Open in browser
start reports/cucumber-report.html
```

### Allure Dashboard (Recommended)
```bash
# Generate and open Allure report
npm run allure:report
npm run allure:open
```

### Combined: Test + Allure Report
```bash
npm run test:allure
```

## ğŸ“ˆ Understanding Test Results

### Report Locations

1. **Cucumber HTML Report**: `reports/cucumber-report.html`
   - Basic test execution summary
   - Step-by-step results
   - Pass/fail status

2. **Allure Dashboard**: `allure-report/index.html` â­
   - Interactive charts and graphs
   - Failure categorization
   - Timeline view
   - Retry information
   - Test history

3. **TEST_SUMMARY.md**: Comprehensive analysis
   - Failure categorization
   - API issues breakdown
   - Prioritized action items
   - Coverage metrics

### Failure Categories

Tests categorize failures to help identify root causes:

| Category | Description | Example |
|----------|-------------|---------|
| **Critical Positive Failures** | Swagger-defined success responses that failed | Order webhook returns 500 instead of 200 |
| **Wrong Error Codes** | API returns wrong error code | Returns 500 instead of 400 for bad input |
| **Missing Authentication** | API accepts unauthenticated requests | Returns 200 instead of 401 |
| **Schema Validation Failures** | Response doesn't match API spec | Empty JSON instead of CAOrderResponse |

## ğŸ” Test Coverage

### Endpoints Tested (8 total)

| Endpoint | Method | Scenarios | Status |
|----------|--------|-----------|--------|
| `/updateDownstreamProcessStatus` | POST | 5 | âš ï¸ Issues |
| `/testException` | POST | 5 | âš ï¸ Issues |
| `/orderwebhook` | POST | 4 | âŒ Critical |
| `/getCaStubApi` | POST | 5 | âŒ Critical |
| `/caReprocessOrders` | POST | 5 | âš ï¸ Issues |
| `/bulkOrderProcess` | POST | 4 | âœ… Pass |
| `/bulkOrderProcessWithDateRange` | POST | 5 | âš ï¸ Issues |
| `/processPaymentClearedOrders` | GET | 4 | âš ï¸ Issues |

### Test Types

- **Positive Tests**: 8 scenarios (success paths)
- **Negative Tests**: 29 scenarios
  - 400 Bad Request: 8 tests
  - 401 Unauthorized: 7 tests  
  - 404 Not Found: 8 tests
  - 500 Server Error: 6 tests

## ğŸ¯ Key Features

### âœ¨ Automatic Retry Logic
All API requests automatically retry up to 3 times on failure:
```javascript
// Configured in helpers/retryHelper.js
RetryHelper.retry(fn, maxAttempts=3, delay=1000)
```

### ğŸ”’ Flexible Authentication
Supports multiple authentication methods configured via `.env`:
- Basic Authentication
- Bearer Token
- No Authentication (for testing)

### ğŸ“Š Schema Validation
Validates response structure against OpenAPI schemas:
```javascript
// Using Ajv library
SchemaValidator.validateResponse('CAOrderResponse', responseData)
```

### ğŸ·ï¸ @no-auth Tag
Special tag for testing unauthorized access without auth setup:
```gherkin
@no-auth
Scenario: Create order with unauthorized access
  When I send a POST request to create order
  Then the response status code should be 401
```

## ğŸ› Known Issues

See [TEST_SUMMARY.md](./TEST_SUMMARY.md) for detailed analysis. Key issues:

1. **Order Webhook Endpoint** - Returns 500 Internal Server Error
2. **CA Stub API** - Returns empty JSON (schema validation fails)
3. **Missing Authentication** - 6 endpoints don't enforce auth properly
4. **Poor Input Validation** - Returns 500 instead of 400 for bad input

## ğŸ”§ Troubleshooting

### Tests fail with "Cannot connect"
- Verify `BASE_URL` in `.env` is correct
- Check network connectivity
- Ensure API server is running

### Authentication failures (401 errors)
- Verify credentials in `.env` file
- Check `AUTH_TYPE` is set correctly
- Ensure API credentials are valid

### Allure report generation fails
- Install Java (required for Allure)
- Run `npm install` to ensure allure-commandline is installed
- Check `allure-results/` directory exists

### Schema validation errors
- Review OpenAPI specification in `api/salesOrderApiDev.json`
- Check `helpers/schemaValidator.js` schema definitions
- Verify API response format matches specification

## ğŸ“š Documentation

- **OpenAPI Specification**: `api/salesOrderApiDev.json`
- **Test Summary**: `TEST_SUMMARY.md`
- **Instructions**: `copilot-instructions.md`

## ğŸ¤ Contributing

### Adding New Tests

1. **Create Feature File** in `features/` directory:
```gherkin
Feature: My New Endpoint
  Scenario: Successfully call endpoint
    Given authentication is set up
    When I send a GET request to my endpoint
    Then the response status code should be 200
```

2. **Create Step Definitions** in `features/step_definitions/`:
```javascript
When('I send a GET request to my endpoint', async function() {
  this.response = await this.orderApiHelper.myEndpoint();
});
```

3. **Add Helper Method** in `helpers/orderApiHelper.js`:
```javascript
async myEndpoint() {
  return await RetryHelper.retry(async () => {
    return await this.request.get('/api/my-endpoint');
  });
}
```

4. **Run Tests**:
```bash
npm test
```

## ğŸ“‹ Scripts Reference

| Script | Command | Description |
|--------|---------|-------------|
| `test` | `npm test` | Run all tests |
| `test:watch` | `npm run test:watch` | Watch mode |
| `generate:allure` | `npm run generate:allure` | Convert Cucumber JSON to Allure |
| `allure:report` | `npm run allure:report` | Generate Allure HTML report |
| `allure:open` | `npm run allure:open` | Open Allure report in browser |
| `test:allure` | `npm run test:allure` | Run tests + generate Allure report |

## ğŸ” Security Notes

- âš ï¸ Never commit `.env` file with real credentials
- âœ… Use `.env.example` as a template
- âœ… Add `.env` to `.gitignore`
- âš ï¸ Current tests revealed 6 endpoints lacking authentication enforcement

## ğŸ“ Support

For issues or questions:
1. Review `TEST_SUMMARY.md` for detailed test results
2. Check `reports/cucumber-report.html` for step-by-step execution
3. View `allure-report/index.html` for interactive dashboard
4. Refer to `copilot-instructions.md` for framework documentation

## ğŸ“ License

Apache 2.0

---

**Last Updated**: November 17, 2025  
**Test Framework Version**: Playwright 1.45+ | Cucumber 10.3+  
**Node Version**: 18+

















